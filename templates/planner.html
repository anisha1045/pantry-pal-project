<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Pantry Pal - Meal Planner" />
    <meta name="author" content="Pantry Pal Team" />
    <title>Meal Planner - Pantry Pal</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-dark bg-dark">
        <div class="container d-flex align-items-center">
            <a class="navbar-brand" href="#!">ü•ó Pantry Pal</a>
            <a class="navbar-item" href="{{ url_for('log') }}">Log</a>
            <a class="navbar-item" href="{{ url_for('planner') }}">Planner</a>
            <a class="navbar-item" href="{{ url_for('library') }}">Library</a>
            {% if session.username %}
            <a class="navbar-item d-flex align-items-center" href="{{ url_for('logout') }}">
                <img src="profile.jpg" alt="Profile" style="width: 40px; height: 40px; background-color: white; border-radius: 50%; margin-right: 15px;">
                Sign Out
            </a>
            {% else %}
            <a class="navbar-item d-flex align-items-center" href="{{ url_for('sign_in') }}">
                <img src="profile.jpg" alt="Profile" style="width: 40px; height: 40px; background-color: white; border-radius: 50%; margin-right: 15px;">
                Sign In
            </a>
            {% endif %}
        </div>
    </nav>

    <!-- Page Content -->
    <section class="py-5">
        <div class="container px-5">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <h2 class="fw-bolder mb-4 text-center">üçΩÔ∏è Meal Planner</h2>
                    <p class="text-muted text-center mb-4">Enter ingredients you have on hand, and we'll suggest a meal just for you.</p>
                    <div class="mb-3">
                        <label for="ingredientsInput" class="form-label fw-bold">Your Ingredients</label>
                        <textarea class="form-control" id="ingredientsInput" rows="4" placeholder="e.g., spinach, eggs, avocado"></textarea>
                    </div>
                    <div class="d-grid">
                        <button class="btn btn-primary btn-lg" onclick="getMealSuggestion()">Get Meal Plan</button>
                    </div>
                    <div id="suggestionLoading" class="text-center text-muted mt-3" style="display: none;">
                        <div class="spinner-border text-primary me-2" role="status"></div>Fetching meal suggestions...
                    </div>
                    <div id="suggestionResults" class="mt-4" style="display: none;"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-4 bg-dark mt-auto">
        <div class="container px-5">
            <p class="m-0 text-center text-white">¬© Pantry Pal 2024</p>
        </div>
    </footer>

    <!-- JS -->
    <script>
        async function getMealSuggestion() {
            const ingredients = document.getElementById('ingredientsInput').value.trim();
            if (!ingredients) {
                alert('Please enter some ingredients');
                return;
            }

            const loading = document.getElementById('suggestionLoading');
            const results = document.getElementById('suggestionResults');
            loading.style.display = 'block';
            results.style.display = 'none';

            try {
                const response = await fetch('/api/meal_suggestion', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ingredients: ingredients })
                });

                const result = await response.json();
                console.log(result);
                if (result.success) {
                    results.innerHTML = `
                        <div class="card mb-3">
                            <div class="card-header bg-success text-white"><strong>Suggested Meal</strong></div>
                            <div class="card-body">${result.suggested_meal}</div>
                        </div>
                        <div class="card mb-3">
                            <div class="card-header bg-info text-white"><strong>Ideal Meal</strong></div>
                            <div class="card-body">${result.ideal_meal}</div>
                        </div>
                        <div class="card mb-3">
                            <div class="card-header bg-warning text-dark"><strong>Evaluation</strong></div>
                            <div class="card-body">${result.evaluation}</div>
                        </div>
                        <div class="card">
                            <div class="card-header bg-primary text-white"><strong>Tips</strong></div>
                            <div class="card-body">
                                <ul class="mb-0">${result.tips.map(tip => `<li>${tip}</li>`).join('')}</ul>
                            </div>
                        </div>
                    `;
                    results.style.display = 'block';
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                loading.style.display = 'none';
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
